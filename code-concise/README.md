# Code-Concise Skill

基于《代码整洁之道》（Robert C. Martin）的自动化代码审查和智能优化技能。

## 技能概述

`code-concise` 是一个专注于**代码审查和优化**的 AI 技能，它采用**渐进式披露**策略，在保证全面分析的同时最小化 token 消耗。

## 核心特性

### 1. 渐进式披露（Progressive Disclosure）
- **Phase 1：快速扫描** - 识别关键问题（~50 tokens）
- **Phase 2：详细审查** - 深入分析特定问题（~200 tokens/问题）
- **Phase 3：优化建议** - 提供完整重构方案（~500 tokens/问题）

### 2. 自动化问题检测
覆盖 7 大类代码问题：
- ✅ 命名规范问题
- ✅ 函数复杂度
- ✅ 代码重复
- ✅ 错误处理
- ✅ 代码结构
- ✅ 注释质量
- ✅ 类设计

### 3. 智能优化识别
- 🔍 性能瓶颈检测
- 🔍 设计模式应用建议
- 🔍 代码简化机会
- 🔍 可维护性改进
- 🔍 安全隐患识别

### 4. 可执行建议
- 📝 具体的重构代码示例（修改前/修改后）
- 🎯 优先级分级（关键/高/中等/低）
- ⏱️ 工作量估算（快速修复/中等/重大）
- ⚠️ 风险评估

## 文件结构

```
code-concise/
├── SKILL.md                          # 主技能文档（完整指南）
├── README.md                         # 本文件
└── references/                       # 参考资料目录
    ├── quick-reference.md            # 快速参考表
    └── usage-examples.md           # 使用示例
```

## 使用方法

### 基本代码审查

```
用户：请审查这段代码
AI：[Phase 1 输出] 快速扫描结果，列出关键和高优先级问题
用户：告诉我更多关于问题 #1
AI：[Phase 2 输出] 详细分析，包含问题说明、影响和修复建议
用户：如何修复问题 #1 和 #3
AI：[Phase 3 输出] 完整的重构代码和实施方案
```

### 批量代码审查

```
用户：审查文件 user-service.js
AI：[Phase 1 输出] 文件级审查摘要，分类列出所有问题
用户：详细说明安全问题（问题 #1, #2）
AI：[Phase 2 输出] 每个安全问题的详细分析和修复方案
```

### 性能优化

```
用户：优化这段代码的性能
AI：识别性能瓶颈，提供优化建议和代码示例
```

## 问题检测规则

### 优先级定义

**🔴 关键（CRITICAL）** - 必须立即修复：
- 安全漏洞（SQL 注入、XSS）
- 数据丢失风险
- 性能灾难
- 逻辑错误
- 空指针异常

**🟡 高优先级（HIGH）** - 应尽快修复：
- 代码重复 > 10 行
- 函数 > 50 行
- 圈复杂度 > 10
- 魔术数字
- 缺少错误处理

**🟢 中等优先级（MEDIUM）** - 应最终修复：
- 无意义的命名
- 命名不一致
- 意图不明确
- 缺少文档
- 过于复杂的逻辑

**⚪ 低优先级（LOW）** - 最好有：
- 格式问题
- 次要风格违规
- 次要命名改进

## 常见问题检测

### 命名问题
- ❌ 使用 `d`, `temp`, `data` 等通用名称
- ✅ 使用描述性名称：`elapsedTimeInDays`

### 函数问题
- ❌ 函数过长（> 20 行）
- ✅ 拆分为更小的函数

### 代码结构
- ❌ 深层嵌套（> 3 层）
- ✅ 使用卫语句和提前返回

### 错误处理
- ❌ 返回 null
- ✅ 使用异常或 Optional 模式

### 类设计
- ❌ 上帝对象（职责过多）
- ✅ 应用单一职责原则

## Token 优化效果

### 传统方式
- 完整审查报告：~2000 tokens
- 包含所有问题的详细解释
- 可能信息过载
- 浪费 token（用户可能只关注部分问题）

### 渐进式披露
- **场景 1**：用户只看概览
  - Token 消耗：~50 tokens
  - 节省：1950 tokens

- **场景 2**：用户深入 1-2 个问题
  - Token 消耗：~50 + 400 = 450 tokens
  - 节省：1550+ tokens

- **场景 3**：用户需要 3 个问题的重构
  - Token 消耗：~50 + 600 + 1500 = 2150 tokens
  - 与传统方式相当，但更聚焦

## 快速参考

| 违规类型 | 模式 | 优先级 | 快速修复 |
|---------|------|--------|---------|
| 通用变量名 | `d`, `temp`, `data` | 中等 | 使用描述性名称 |
| 长函数 | > 20 行 | 高 | 拆分为小函数 |
| 参数过多 | > 3 个参数 | 高 | 使用参数对象 |
| 深层嵌套 | > 3 层 | 中等 | 使用卫语句 |
| 重复代码 | > 10 行重复 | 高 | 提取为函数 |
| 魔术数字 | 无解释的数字 | 中等 | 使用命名常量 |
| 返回 null | 返回 null | 关键 | 使用异常/Optional |
| 空的 catch | `catch(e) {}` | 高 | 正确处理 |
| 大类 | > 200 行 | 中等 | 拆分类 |
| 上帝对象 | 多重职责 | 高 | 应用 SRP |

## 最佳实践

### 对于代码审查者
1. ✅ 总是从 Phase 1 开始
2. ✅ 只在用户请求时进入 Phase 2/3
3. ✅ 优先显示关键和高优先级问题
4. ✅ 使用清晰的格式（表情符号、颜色）
5. ✅ 提供具体的行号引用
6. ✅ 提供前后对比代码示例

### 对于使用者
1. ✅ 先查看 Phase 1 摘要
2. ✅ 只请求需要详细说明的问题
3. ✅ 在准备实施时再请求重构代码
4. ✅ 按严重程度优先处理问题
5. ✅ 测试所有变更

## 参考资料

### SKILL.md
完整的技能指南，包含：
- 渐进式披露方法说明
- 7 大类问题的检测规则
- 每个问题的 Before/After 代码示例
- 交互式审查工作流程
- Token 高效响应模式
- 最佳实践和注意事项

### references/quick-reference.md
快速查找表，包含：
- 严重程度矩阵
- 常见模式
- 代码指标参考
- 重构技术
- 快速修复模板

### references/usage-examples.md
实际使用示例，包含：
- 基本代码审查示例
- 完整重构请求示例
- 批量代码审查示例
- 渐进式披露流程图
- Token 消耗对比
- 常见问题解答

## 基于《代码整洁之道》

本技能基于 Robert C. Martin（Uncle Bob）的经典著作《代码整洁之道》，涵盖：

- **第 2 章**：有意义的命名
- **第 3 章**：函数
- **第 4 章**：注释
- **第 5 章**：格式
- **第 6 章**：对象和数据结构
- **第 7 章**：错误处理
- **第 8 章**：边界
- **第 9 章**：单元测试
- **第 10 章**：类
- **第 11 章**：系统
- **第 12 章**：迭进
- **第 13 章**：并发编程
- **第 17 章**：味道与启发式

## 版本信息

- **版本**：1.0
- **创建日期**：2025
- **基于**：《代码整洁之道》by Robert C. Martin
- **特点**：渐进式披露、自动化检测、智能优化

## 许可证

本技能基于《代码整洁之道》的原则创建，遵循其教育和指导精神。
